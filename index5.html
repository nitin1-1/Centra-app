<!DOCTYPE html>
<html>
<head>
    <title>Emergency Device Configuration</title>

    <style>
        body {
            margin: 0;
            font-family: "Segoe UI", sans-serif;
            background: linear-gradient(135deg, #0f172a, #1e293b);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: white;
        }

        .container {
            background: #111827;
            width: 550px;
            max-height: 85vh;
            padding: 25px 30px;
            border-radius: 14px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.6);
            border: 1px solid #1f2937;
            display: flex;
            flex-direction: column;
        }

        h2 {
            margin: 0 0 5px 0;
            font-weight: 500;
        }

        .subtitle {
            font-size: 13px;
            opacity: 0.6;
            margin-bottom: 15px;
        }

        .table-wrapper {
            overflow-y: auto;
            max-height: 45vh;
            border: 1px solid #1f2937;
            border-radius: 8px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background-color: #2563eb;
            padding: 10px;
            text-align: left;
            font-size: 13px;
        }

        td {
            padding: 8px;
            border-bottom: 1px solid #1f2937;
        }

        select, input {
            width: 100%;
            padding: 6px;
            border-radius: 6px;
            border: 1px solid #334155;
            background-color: #1e293b;
            color: white;
            font-size: 13px;
        }

        .error {
            color: #ef4444;
            font-size: 12px;
            margin-top: 3px;
        }

        .control-panel {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .control-panel input {
            width: 70px;
            text-align: center;
        }

        .control-panel button {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            background: #2563eb;
            color: white;
            cursor: pointer;
            transition: 0.2s;
        }

        .control-panel button:hover {
            background: #1d4ed8;
        }

        .save-btn {
            margin-top: 15px;
            padding: 10px;
            background: #2563eb;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
        }

        .success {
            margin-top: 10px;
            color: #22c55e;
            font-size: 13px;
        }

        /* Fade-in animation */
        .fade-in {
            animation: fadeIn 0.25s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(6px); }
            to { opacity: 1; transform: translateY(0); }
        }


/* Custom Scrollbar Styling */

/* Chrome, Edge, Safari */
.table-wrapper::-webkit-scrollbar {
    width: 10px;
}

.table-wrapper::-webkit-scrollbar-track {
    background: #0f172a;
    border-radius: 8px;
}

.table-wrapper::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, #2563eb, #1d4ed8);
    border-radius: 8px;
    border: 2px solid #0f172a;
}

.table-wrapper::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(180deg, #3b82f6, #2563eb);
}

/* Firefox */
.table-wrapper {
    scrollbar-width: thin;
    scrollbar-color: #2563eb #0f172a;
}





    </style>
</head>
<body>

<div class="container">
    <h2>Emergency Response Device</h2>
    <div class="subtitle">CONTACT CONFIGURATION PANEL</div>

    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>#</th>
                    <th>COUNTRY</th>
                    <th>PHONE NUMBER</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <div class="control-panel">
        <button onclick="modifyRows(-1)">âˆ’</button>
        <input type="number" id="rowAmount" value="1" min="1">
        <button onclick="modifyRows(1)">+</button>
    </div>

    <button class="save-btn" onclick="saveNumbers()">Save Configuration</button>
    <div id="status"></div>
</div>

<script>

let savedNumbers = [];

window.onload = function() {
    const stored = localStorage.getItem("emergencyContacts");
    if (stored) {
        savedNumbers = JSON.parse(stored);
    }
    renderInitialRows();
};

function renderInitialRows() {
    const tableBody = document.getElementById("tableBody");
    tableBody.innerHTML = "";

    if (savedNumbers.length > 0) {
        savedNumbers.forEach(entry => {
            addRow(entry.country, entry.number, false);
        });
    }

    while (tableBody.rows.length < 3) {
        addRow();
    }
}

function addRow(country = "+1", number = "", animate = true) {

    const tableBody = document.getElementById("tableBody");
    const row = tableBody.insertRow();

    if (animate) row.classList.add("fade-in");

    const indexCell = row.insertCell(0);
    const countryCell = row.insertCell(1);
    const phoneCell = row.insertCell(2);

    indexCell.textContent = tableBody.rows.length;

    countryCell.innerHTML = `
        <select>
            <option value="+1" ${country === "+1" ? "selected" : ""}>+1 (US)</option>
            <option value="+44" ${country === "+44" ? "selected" : ""}>+44 (UK)</option>
            <option value="+91" ${country === "+91" ? "selected" : ""}>+91 (IN)</option>
            <option value="+61" ${country === "+61" ? "selected" : ""}>+61 (AU)</option>
        </select>
    `;

    phoneCell.innerHTML = `
        <input type="text" maxlength="12"
               value="${formatForDisplay(number)}"
               placeholder="XXX-XXX-XXXX"
               oninput="formatNumber(this)">
        <div class="error"></div>
    `;
}

function modifyRows(direction) {

    const amount = parseInt(document.getElementById("rowAmount").value) || 1;
    const tableBody = document.getElementById("tableBody");

    if (direction === 1) {
        for (let i = 0; i < amount; i++) {
            addRow();
        }
    }

    if (direction === -1) {
        for (let i = 0; i < amount; i++) {
            if (tableBody.rows.length > 1) {
                tableBody.deleteRow(-1);
            }
        }
    }

    updateRowNumbers();
}

function updateRowNumbers() {
    const rows = document.querySelectorAll("#tableBody tr");
    rows.forEach((row, index) => {
        row.cells[0].textContent = index + 1;
    });
}

function formatNumber(input) {

    const errorDiv = input.nextElementSibling;

    if (/[A-Za-z]/.test(input.value)) {
        errorDiv.textContent = "Invalid Input!";
        return;
    } else {
        errorDiv.textContent = "";
    }

    let digits = input.value.replace(/\D/g, "").substring(0, 10);
    input.value = formatForDisplay(digits);
}

function formatForDisplay(digits) {

    if (!digits) return "";

    if (digits.length > 6) {
        return digits.slice(0,3) + "-" + digits.slice(3,6) + "-" + digits.slice(6);
    } else if (digits.length > 3) {
        return digits.slice(0,3) + "-" + digits.slice(3);
    }
    return digits;
}

function saveNumbers() {

    const rows = document.querySelectorAll("#tableBody tr");
    let newSaved = [];
    let hasError = false;

    rows.forEach(row => {

        const select = row.querySelector("select");
        const input = row.querySelector("input");
        const errorDiv = row.querySelector(".error");

        if (/[A-Za-z]/.test(input.value)) {
            errorDiv.textContent = "Invalid Input!";
            hasError = true;
            return;
        }

        let digits = input.value.replace(/\D/g, "");

        if (digits.length > 0) {
            newSaved.push({
                country: select.value,
                number: digits
            });
        }
    });

    if (hasError) {
        document.getElementById("status").innerHTML = "";
        return;
    }

    savedNumbers = newSaved;
    localStorage.setItem("emergencyContacts", JSON.stringify(savedNumbers));

    document.getElementById("status").innerHTML =
        "<div class='success'>Configuration Saved Successfully!</div>";
}

</script>

</body>
</html>
